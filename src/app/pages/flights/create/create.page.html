 <app-shared-header title="Flights"></app-shared-header>
<ion-content class="ion-padding">
  <form [formGroup]="flightForm" (ngSubmit)="onSubmit()">
    
    <ion-item lines="full">
      <ion-label position="stacked">Flight Number</ion-label>
      <ion-input formControlName="flightNumber" placeholder="e.g. QR001" style="text-transform: uppercase;"></ion-input>
    </ion-item>
    
    @if (flightForm.get('flightNumber')?.touched && flightForm.get('flightNumber')?.invalid) {
      <ion-text color="danger" class="ion-padding-start">
        <small>Valid Flight Number required (3-10 characters).</small>
      </ion-text>
    }

    <ion-item lines="full">
      <ion-label position="stacked">Total Passenger Sequences (Capacity)</ion-label>
      <ion-input type="number" formControlName="highestSequence" placeholder="e.g. 150"></ion-input>
    </ion-item>

    @if (flightForm.get('highestSequence')?.touched && flightForm.get('highestSequence')?.invalid) {
      <ion-text color="danger" class="ion-padding-start">
        <small>Please enter a valid capacity (1-500).</small>
      </ion-text>
    }

    <div class="ion-padding">
      @if (successMessage) {
        <ion-text color="success">
          <p class="ion-no-margin">{{ successMessage }}</p>
        </ion-text>
      }
      @if (errorMessage) {
        <ion-text color="danger">
          <p class="ion-no-margin">{{ errorMessage }}</p>
        </ion-text>
      }
    </div>

    <div class="ion-padding-top">
      <ion-button expand="block" type="submit" [disabled]="flightForm.invalid || isLoading">
        @if (isLoading) { <ion-spinner name="crescent"></ion-spinner> }
        @else { Create Flight }
      </ion-button>
      
      <ion-button expand="block" fill="outline" color="medium" (click)="generateFlightNumber()">
        Generate Random ID
      </ion-button>
    </div>
  </form>

  @if (recentFlights.length > 0) {
    <ion-list-header>
      <ion-label>Recently Registered</ion-label>
    </ion-list-header>
    <ion-list>
      @for (f of recentFlights; track f.flightNumber) {
        <ion-item>
          <ion-label>
            <h2>{{ f.flightNumber }}</h2>
            <p>Operational Date: {{ f.flightDate }}</p> <p>Status: <ion-badge color="primary">{{ f.status }}</ion-badge></p>
          </ion-label>
        </ion-item>
      }
    </ion-list>
  }
</ion-content>